<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.portal.admin.dao.FaqMgmDao">

    <select id="search"  resultType="ParamMap">
        SELECT  
                A.FAQ_ID
        ,       A.QUESTION
        ,       A.ANSWER
        ,       A.SORT_NO
        ,       A.USE_YN
        FROM    FAQ     A 
        WHERE	1 = 1
        <if test="cmgrpCd != null">
		AND		A.CMGRP_CD 		= #{cmgrpCd} 
		</if>
        ORDER   BY
                A.SORT_NO
    </select>
    <insert id="save"  parameterType="map">
        MERGE INTO FAQ  A
        USING (SELECT 'A' AS A) B
        ON  A.FAQ_ID = #{faqId}
        <if test="cmgrpCd != null">
		AND		A.CMGRP_CD 		= #{cmgrpCd} 
		</if>
        WHEN    MATCHED THEN
                UPDATE
                SET
                    QUESTION        = #{question}
                ,   ANSWER          = #{answer}
                ,   SORT_NO         = #{sortNo}
                ,   USE_YN          = #{useYn}
                ,   UPDATE_BY       = #{loginUserId}
                ,   UPDATE_DATE     = NOW()
		        ,   TRLG_KEY_VAL		= NULL
		        ,	LT_CHPR_ID		=	#{loginUserId}
		        ,	LT_CH_DTTI		= FN_DATE_TO_CHAR(NOW(),'YYYYMMDDHHMISSMS')
		        <if test="cmgrpCd != null">
				AND		CMGRP_CD 		= #{cmgrpCd} 
				</if> 
        WHEN    NOT MATCHED THEN
                INSERT
                (
                    QUESTION        
                ,   ANSWER          
                ,   SORT_NO         
                ,   USE_YN          
                ,   CREATE_BY       
                ,   CREATE_DATE     
                ,	TRLG_KEY_VAL
		        ,	LT_CHPR_ID
		        ,	LT_CH_DTTI
		        <if test="cmgrpCd != null">
				,	CMGRP_CD
				</if>
                )
                VALUES
                (
                    #{question}
                ,   #{answer}
                ,   #{sortNo}
                ,   #{useYn}
                ,   #{loginUserId}
                ,   NOW()
                ,	NULL
		        ,	#{loginUserId}
		        ,	FN_DATE_TO_CHAR(NOW(),'YYYYMMDDHHMISSMS')
		        <if test="cmgrpCd != null">
				,	#{cmgrpCd} 
				</if>
                );
    </insert>
    
    <delete id="delete" parameterType="map">
        DELETE FROM FAQ
        WHERE FAQ_ID = #{faqId}
        <if test="cmgrpCd != null">
		AND	CMGRP_CD = #{cmgrpCd} 
		</if>
    </delete>
    
</mapper>